(this.webpackJsonpblack=this.webpackJsonpblack||[]).push([[0],{45:function(e,t,n){e.exports=n(84)},71:function(e,t,n){},73:function(e,t,n){},76:function(e,t,n){},77:function(e,t,n){},78:function(e,t,n){},79:function(e,t,n){},80:function(e,t,n){},81:function(e,t,n){},82:function(e,t,n){},83:function(e,t,n){},84:function(e,t,n){"use strict";n.r(t);var a,r=n(0),c=n.n(r),i=n(3),o=n(22),s=n.n(o),u=n(24),l=n(13),m=n(10),p=n.n(m),f=window&&window.location&&window.location.hostname;"localhost"===f?a="http://localhost:9999":"blackq.herokuapp.com."===f&&(a="https://blackq.herokuapp.com.");var d="".concat(a,"/api/");p.a.defaults.baseURL=d,p.a.interceptors.response.use(function(e){return Promise.resolve(e)},function(e){switch(e.response.status){case 666:window.location.href="/login";break;default:return Promise.reject(e)}});var h=n(2),b=n.n(h),O=n(6),g=n(4),v=n(5);n(71);function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function j(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach(function(t){Object(g.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var E={path:"/login"},w=n(12);function _(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function N(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_(Object(n),!0).forEach(function(t){Object(g.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var I=localStorage,S=function(e){return JSON.stringify(e)},P=function(e){return JSON.parse(e)},C=P(I.getItem("currentUserId")),k=function(e){return P(I.getItem("user_".concat(e||C)))},D=function(e){var t=e.settings,n=Object(w.a)(e,["settings"]);if(I.getItem("user_"+n._id)){var a=k(n._id);return I.setItem("currentUserId",S(n._id)),void I.setItem("user_".concat(n._id),S(N({},a,{user:N({},n),settings:N({},a.settings,{},t)})))}I.setItem("currentUserId",S(n._id)),I.setItem("user_".concat(n._id),S({user:n,settings:t}))},T=function(e,t){if(C){var n=k();I.setItem("user_".concat(C),S(N({},n,Object(g.a)({},e,t))))}},A=function(e){var t=k();return t?t[e]:null},U=function(e){var t=k();delete t[e],I.setItem("user_".concat(C),S(t))};function x(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function L(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?x(Object(n),!0).forEach(function(t){Object(g.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var H={headers:{"x-dark-token":sessionStorage.getItem("x-dark-token")}},R=function(e,t){return p.a.put("auth",{name:e,pass:t})},M=function(){return p.a.delete("auth",H)},W=function(){return p.a.get("users",H)},q=function(){return p.a.get("chat",H)},F=function(e,t,n){return p.a.get("chat/timeline",L({},H,{params:{chatId:e,limit:t,offset:n}}))},J=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return p.a.get("users/search",L({},H,{params:{q:e,limit:t,offset:n}}))},G=function(e){return p.a.post("chat",{userId:e},H)},z=function(e,t,n){return p.a.put("users/create",{name:e,pass:t,ava:n})},K=n(7),Q=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"_id",n={},a=e.map(function(e){var a=e[t];return n[a]=e,a});return{entities:n,ids:a}};function V(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function B(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?V(Object(n),!0).forEach(function(t){Object(g.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):V(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var Y=function(e){var t={};for(var n in e.entities)if(e.entities[n].lastInteraction){var a=e.entities[n].lastInteraction;t[n]=B({},e.entities[n],{lastInteraction:JSON.parse(a)})}else t[n]=e.entities[n];return{ids:e.ids,entities:t}},X="ping",Z="message",$="inc",ee="out",te="sys",ne="new-chat";function ae(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function re(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ae(Object(n),!0).forEach(function(t){Object(g.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ae(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var ce=function(e){return function(t){t({type:"SET_ACTIVE_CHAT_ID",payload:e}),T("activeChatId",e)}},ie={activeChatId:null,msgForSend:null,timeline:[]};function oe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function se(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?oe(Object(n),!0).forEach(function(t){Object(g.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):oe(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var ue={entities:{},ids:[]};function le(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function me(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?le(Object(n),!0).forEach(function(t){Object(g.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):le(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var pe="GET_ALL_USERS",fe={entities:{},ids:[]};function de(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function he(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?de(Object(n),!0).forEach(function(t){Object(g.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):de(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var be={currentUser:null,isAuth:!!A("user")||!1};function Oe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}var ge={setCurrentWindow:function(e){return function(t){t({type:"SET_CURRENT_WINDOW",payload:e})}},handleAuthLogin:function(e,t){return function(){var n=Object(O.a)(b.a.mark(function n(a){var r,c,i;return b.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,R(e,t);case 2:r=n.sent,(c=r.data)&&(i=c["x-dark-token"],sessionStorage.setItem("x-dark-token",i),delete c["x-dark-token"],D(c),a({type:"SET_IS_AUTH",payload:!0}),window.location.href="/");case 5:case"end":return n.stop()}},n)}));return function(e){return n.apply(this,arguments)}}()}},ve=Object(l.g)(Object(i.b)(null,ge)(function(e){var t=Object(r.useState)({name:"",pass:""}),n=Object(v.a)(t,2),a=n[0],i=n[1],o=function(e,t){e.preventDefault();var n=e.target.value;i(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Oe(Object(n),!0).forEach(function(t){Object(g.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Oe(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},a,Object(g.a)({},t,n)))},s=function(){var t=Object(O.a)(b.a.mark(function t(n){return b.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n.preventDefault(),e.handleAuthLogin(a.name,a.pass);case 2:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}();return c.a.createElement("main",{className:"login-wrapper"},c.a.createElement("form",{onSubmit:s},c.a.createElement("input",{type:"text",value:a.name,placeholder:"Name ...",onChange:function(e){return o(e,"name")},required:!0}),c.a.createElement("input",{autoComplete:"new-password",type:"password",value:a.pass,placeholder:"Password ...",onChange:function(e){return o(e,"pass")},required:!0}),c.a.createElement("div",{className:"controls"},c.a.createElement("button",{type:"submit",className:"btn btn-primary btn-primary--wide"},"Log In"))))})),ye=function(e){var t=Object(r.useRef)(e);return Object(r.useEffect)(function(){t.current=e}),t.current},je=window&&window.location&&window.location.hostname,Ee="".concat("localhost"===je?"ws://localhost:8888":"blackq.herokuapp.com."===je?"ws://blackq.herokuapp.com.:8888":"ws://127.0.0.1:8888"),we={addNewMsgToActiveChat:function(e){return function(t){t({type:"ADD_NEW_MSG",payload:e})}},addNewChat:function(e){return function(t){t({type:"ADD_NEW_CHAT",payload:{chat:Q([e.chat]),users:Q(e.participantsObjects)}})}}},_e=Object(i.b)(null,we)(c.a.memo(function(e){var t=e.component,n=e.addNewMsgToActiveChat,a=e.addNewChat,i=new WebSocket(Ee);Object(r.useEffect)(function(){return s(),function(){i.close()}},[i]);var o=Object(r.useCallback)(function(e,t,n){i.send(JSON.stringify({data:{body:t,chatId:e,senderId:n},type:"message"}))},[i]),s=function(){i.onopen=function(){console.log("Socket connected!)")},i.onclose=function(){console.log("Socket disconnected!(")},i.onerror=function(e){console.log("Socket error: ",e)},i.onmessage=function(e){var t=JSON.parse(e.data),r=t.data,c=t.type;switch(console.log("CHAT SOCKET EVENT::::::>>> data:",r,"type:",c),c){case X:i.send(JSON.stringify({data:"pong",type:"pong"}));break;case ee:case $:case te:case Z:n(r);break;case ne:a(r)}}};return c.a.createElement(t,{sendMsg:o})})),Ne=(n(73),n(16)),Ie=n(17),Se=(n(76),function(e){var t=function(){var t=Object(O.a)(b.a.mark(function t(){return b.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,M();case 2:window.confirm("are u sure?")&&e.handleAuthLogout();case 3:case"end":return t.stop()}},t)}));return function(){return t.apply(this,arguments)}}();return c.a.createElement("header",{className:"header"},c.a.createElement("div",{className:"header__wrap"},c.a.createElement("button",{className:"header__settings",onClick:function(){return console.log("settings here")}},c.a.createElement(Ne.a,{icon:Ie.a,size:"2x"})),c.a.createElement("h1",{className:"header__head"},"BLACK"),c.a.createElement("button",{className:"header__logout",onClick:t},c.a.createElement(Ne.a,{icon:Ie.c,size:"2x"}))))}),Pe=function(e){var t=e.classNamePrefix,n=e.setQuery;return c.a.createElement("div",{className:"".concat(t,"__searcher-wrap")},c.a.createElement("input",{value:e.query,type:"text",className:"".concat(t,"__input"),onChange:function(e){return n(e.target.value)}}),c.a.createElement(Ne.a,{className:"".concat(t,"__icon"),icon:Ie.d}))},Ce=function(e){return e&&e.ava?e.ava:"./media/default.png"},ke=function(e){return void 0!==e.chatType?function(e){if(e.ava)return e.ava;switch(e.chatType){case 0:return"./media/bookmark.png";default:return"./media/default.png"}}(e):Ce(e)},De=function(e){var t=e.item,n=e.setSearchState,a=e.setQuery,r=function(){var e=Object(O.a)(b.a.mark(function e(){return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n([]),a(""),e.next=4,G(t._id);case 4:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}();return c.a.createElement("li",{className:"chat-list-item"},c.a.createElement("div",{"data-isonline":t.isOnline,className:"chat-list-item__ava-wrap"},c.a.createElement("img",{src:ke(t),alt:"user avatar"})),c.a.createElement("div",{className:"chat-list-item__info-block chat-list-item__info-block--search"},c.a.createElement("span",{className:"chat-list-item__chat-name chat-list-item__chat-name--search"},t.name||"NoNameNPC")),c.a.createElement("div",{className:"chat-list-item__utils-block chat-list-item__utils-block--search"},c.a.createElement("span",{onClick:r,className:"chat-list-item__add-conversation"},c.a.createElement(Ne.a,{icon:Ie.b}))))},Te=function(e){var t=e.className,n=e.listItems,a=e.component;return c.a.createElement("ul",{className:t},n.map(function(t){return c.a.createElement(a,Object.assign({key:t._id||t,item:t},e.listItemProps))}))},Ae=function(e){var t=new Date,n=new Date(e).toLocaleString("en-US",{day:"numeric",month:"2-digit",year:"numeric"}),a=(new Date).toLocaleString("en-US",{day:"numeric",month:"2-digit",year:"numeric"}),r=new Date(t.setDate(t.getDate()-1)).toLocaleString("en-US",{day:"numeric",month:"2-digit",year:"numeric"}),c=new Date(e).toLocaleDateString("en-US",{day:"numeric",month:"short"});return n===a?new Date(e).toLocaleTimeString().slice(0,5):n===r?"Yesterday":c},Ue=(n(77),function(e){var t=e.className,n=e.width,a=void 0===n?"100%":n,r=e.height,i=void 0===r?"100%":r;return c.a.createElement("img",{src:"/media/spinner.gif",width:a,height:i,className:t,alt:"Loading..."})}),xe=(n(78),function(e){var t=e.alt,n=e.className,a=e.onClick,i=(e.spinnerStyles,Object(w.a)(e,["alt","className","onClick","spinnerStyles"])),o=Object(r.useState)({imageLoaded:!1,error:void 0}),s=Object(v.a)(o,2),u=s[0],l=s[1],m=!u.error&&u.imageLoaded?"lazy-load__image":"lazy-load__image--hidden",p=n||"";return c.a.createElement("div",{className:"lazy-load__container"},u.imageLoaded?null:c.a.createElement(Ue,null),u.error?c.a.createElement("img",{className:"lazy-load__error",alt:"error",title:u.error,src:"./media/error.png"}):null,c.a.createElement("img",Object.assign({},i,{alt:t||"lazy",className:"".concat(m," ").concat(p),onClick:a,onLoad:function(){l({imageLoaded:!0,error:""})},onError:function(){l({error:"Failed to load image...",imageLoaded:!0})}})))}),Le=Object(i.b)(function(e,t){return{chat:e.chats.entities[t.item],activeChat:e.activeChat.activeChatId,currentUserId:e.auth.currentUser._id}})(function(e){var t,n=e.chat,a=e.setActiveChatId,r=e.currentUserId,i=Object(w.a)(e,["chat","setActiveChatId","currentUserId"]);return c.a.createElement("li",{"data-isselected":i.item===i.activeChat,onClick:function(){return a(i.item)},className:"chat-list-item"},c.a.createElement("div",{className:"chat-list-item__ava-wrap"},c.a.createElement(xe,{src:ke(n)})),c.a.createElement("div",{className:"chat-list-item__info-block"},c.a.createElement("span",{className:"chat-list-item__chat-name"},n?function(){switch(n.chatType){case 1:var e=n.participants.find(function(e){return e!==r});return n.users&&n.users.entities[e].name;default:return n.chatName}}():"Chat name loading..."),c.a.createElement("span",{className:"chat-list-item__last-msg"},n&&n.lastInteraction&&n.lastInteraction.data?(t=n.lastInteraction.data,r===t.senderId?"You: "+t.body:t.body):"Chat is empty...")),c.a.createElement("div",{className:"chat-list-item__utils-block"},c.a.createElement("span",{className:"chat-list-item__time"},n&&n.lastInteraction&&n.lastInteraction.date?Ae(n.lastInteraction.date):"00:00"),n&&n.unreadCount?c.a.createElement("span",{className:"chat-list-item__unread"},n.unreadCount):null))}),He={setActiveChatId:ce,handleAuthLogout:function(){return function(e){sessionStorage.removeItem("x-dark-token"),window.location.href="/login",U("user"),e({type:"AUTH_LOGIN"})}}},Re=Object(i.b)(function(e){return{chatsIds:e.chats.ids}},He)(function(e){var t=e.chatsIds,n=Object(w.a)(e,["chatsIds"]),a=Object(r.useState)([]),i=Object(v.a)(a,2),o=i[0],s=i[1],u=Object(r.useState)([]),l=Object(v.a)(u,2),m=l[0],p=l[1],f=Object(r.useState)(""),d=Object(v.a)(f,2),h=d[0],b=d[1],O=Object(r.useState)(!1),g=Object(v.a)(O,2),y=g[0],j=g[1],E=Object(r.useRef)(),_=Object(r.useCallback)(function(e,t){var n,a,r=!0;return function c(){for(var i=c,o=arguments.length,s=new Array(o),u=0;u<o;u++)s[u]=arguments[u];if(!r)return n=i,void(a=s);e.apply(i,s),r=!1,setTimeout(function(){r=!0,a&&(c.apply(n,a),a=n=null)},t)}}(function(e,t){return J(e,20,t).then(function(e){return p(e.data)}).catch(console.error)},400),[]);Object(r.useEffect)(function(){s(t)},[t]),Object(r.useEffect)(function(){return j(!1)},[m.length]),Object(r.useEffect)(function(){h.length>1&&_(h)},[h,h.length,_]);var N=Object(r.useCallback)(function(e){return n.setActiveChatId(e)},[]);return c.a.createElement("aside",{onScroll:function(){if(E.current.scrollHeight&&E.current.scrollHeight-E.current.scrollTop-E.current.clientHeight<400&&!y){var e=m.length;j(!0),J(h,20,e).then(function(e){p([].concat(Object(K.a)(m),Object(K.a)(e.data)))}).catch(console.error)}},ref:E,className:"aside-chats"},c.a.createElement(Se,{handleAuthLogout:n.handleAuthLogout}),c.a.createElement(Pe,{query:h,setQuery:b,setSearchState:p,classNamePrefix:"searcher"}),c.a.createElement(Te,{listItems:h.length?m:o,component:h.length?De:Le,listItemProps:h.length?{setSearchState:p,setQuery:b}:{setActiveChatId:N},className:"chat-list"}))}),Me=(n(79),n(80),n(41)),We=function(e){return e.auth.currentUser&&e.auth.currentUser._id},qe=Object(Me.a)(function(e,t){return e.users.entities[t]},function(e,t){return e.auth.currentUser},function(e,t){return t},function(e,t,n){return e||t._id===n?e||t._id!==n?e||void 0:t:{}}),Fe=Object(i.b)(function(e){return{activeChatId:e.activeChat.activeChatId,senderId:We(e)}})(function(e){var t=Object(r.useState)(""),n=Object(v.a)(t,2),a=n[0],i=n[1],o=Object(r.useRef)();return c.a.createElement("div",{className:"chat-input"},c.a.createElement("div",{ref:o,contentEditable:!0,onKeyDown:function(t){"Enter"===t.key&&t.shiftKey||("Enter"!==t.key||o.current.innerText.trim().length?"Enter"!==t.key||t.shiftKey||(t.preventDefault(),e.sendMsg(e.activeChatId,a,e.senderId),o.current.innerText="",i("")):t.preventDefault())},onInput:function(e){i(e.target.innerText)},className:"chat-input__input"}),!a.length&&c.a.createElement("span",{className:"chat-input__placeholder"},"Message..."))}),Je=(n(81),Object(i.b)(function(e,t){return{user:qe(e,t.message.data.senderId),currentUser:e.auth.currentUser}})(function(e){return c.a.createElement("li",{key:e.message._id,className:"chat-timeline-list__item"},c.a.createElement("section",{"data-msg-type":e.message.data.senderId===e.currentUser._id?"out":"inc",className:"chat-timeline-list__msg-wrap"},c.a.createElement("div",{className:"chat-timeline-list__ava-wrp"},c.a.createElement(xe,{src:ke(e.user),alt:"user avatar"})),c.a.createElement("div",{className:"chat-timeline-list__info-block"},c.a.createElement("span",{className:"chat-timeline-list__name"},e.user.name||"loading..."),c.a.createElement("span",{className:"chat-timeline-list__time"},Ae(e.message.date))),c.a.createElement("p",{className:"chat-timeline-list__msg-body"},e.message.data.body)))})),Ge={getChatTimeline:function(e){return function(){var t=Object(O.a)(b.a.mark(function t(n){var a;return b.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,F(e,15,0);case 2:a=t.sent,n({type:"SET_CHAT_TIMELINE",payload:a.data});case 4:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()},updateChatTimeline:function(e,t,n){return function(){var a=Object(O.a)(b.a.mark(function a(r){var c;return b.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,F(e,t,n);case 2:c=a.sent,r({type:"UPDATE_CHAT_TIMELINE",payload:c.data});case 4:case"end":return a.stop()}},a)}));return function(e){return a.apply(this,arguments)}}()}},ze=Object(i.b)(function(e){return{timeline:e.activeChat.timeline}},Ge)(function(e){var t=Object(r.useState)([]),n=Object(v.a)(t,2),a=n[0],i=n[1],o=Object(r.useState)(!1),s=Object(v.a)(o,2),u=s[0],l=s[1],m=Object(r.useRef)(),p=ye(a.length),f=ye(e.activeChatId);Object(r.useEffect)(function(){e.getChatTimeline(e.activeChatId)},[]),Object(r.useEffect)(function(){f!==e.activeChatId&&e.getChatTimeline(e.activeChatId)},[e.activeChatId]),Object(r.useEffect)(function(){i(e.timeline)},[e.timeline]),Object(r.useEffect)(function(){0!==p&&a.length-p!==1||(m.current.scrollTop=m.current.scrollHeight),l(!1)},[a.length]);return c.a.createElement("section",{onScroll:function(){m.current.scrollHeight&&m.current.scrollTop<400&&!u&&(l(!0),e.updateChatTimeline(e.activeChatId,15,a.length))},ref:m,className:"chat-timeline"},c.a.createElement("ul",{className:"chat-timeline-list"},a.length?a.map(function(e){return c.a.createElement(Je,{key:e._id,message:e})}):null))}),Ke=Object(i.b)(function(e){return{activeChatId:e.activeChat.activeChatId}})(function(e){return e.activeChatId?c.a.createElement("section",{className:"chat-window"},c.a.createElement(ze,{activeChatId:e.activeChatId}),c.a.createElement(Fe,{sendMsg:e.sendMsg})):null}),Qe=function(e){return c.a.createElement(c.a.Fragment,null,c.a.createElement(Re,null),c.a.createElement(Ke,{sendMsg:e.sendMsg}))},Ve=(n(82),{initApp:function(){return function(e){var t=A("activeChatId");e(function(e){e({type:"CURRENT_USER_UPDATE",payload:A("user")})}),e(function(){var e=Object(O.a)(b.a.mark(function e(t){var n,a;return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,W();case 2:n=e.sent,a=n.data,t({type:pe,payload:Q(a)});case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),e(function(){var e=Object(O.a)(b.a.mark(function e(t){var n,a;return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,q();case 2:n=e.sent,a=n.data,t({type:"GET_ALL_CHATS",payload:Y(Q(a))});case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),t&&e(ce(t))}}}),Be=Object(i.b)(function(e){return{isAuth:e.auth.isAuth}},Ve)(function(e){var t=e.initApp,n=e.isAuth,a=ye(n);return Object(r.useEffect)(function(){t()},[t]),Object(r.useEffect)(function(){var e=A("user");(!1===a&&n||!e)&&(window.location.href="/login"),e||(window.location.href="/login")},[n]),c.a.createElement("main",{className:"main"},c.a.createElement(_e,{component:Qe}))}),Ye=n(19),Xe=function(e){var t=e.name,n=e.pass,a=e.pass2,r={};return t&&t.trim().length||(r.name="Chouse your nickname"),n&&n.trim().length||(r.pass="Enter a password"),a&&a.trim().length||(r.pass2="Confirm your password"),n&&a&&a!==n&&(r.pass2="password is not equal"),r},Ze=function(){var e=Object(r.useState)({file:"",url:""}),t=Object(v.a)(e,2),n=t[0],a=t[1],i=function(e){var t=e.target.files[0],n=new FileReader;n.onloadend=function(){a({file:n.result,url:URL.createObjectURL(t)})},t&&n.readAsDataURL(t)};return c.a.createElement("div",{className:"login-wrapper"},c.a.createElement(Ye.b,{onSubmit:function(e){z(e.name,e.pass,n.file).then(function(){window.location.href="/login"}).catch(console.error)},validate:Xe},function(e){var t=e.handleSubmit,a=e.submitting,r=e.pristine;return c.a.createElement("form",{onSubmit:t},c.a.createElement("label",{htmlFor:"file-input",className:"img-wrap"},c.a.createElement("img",{src:n.url||Ce(),alt:""})),c.a.createElement(Ye.a,{name:"file",type:"file",onChange:i,tebindex:1,component:"input",id:"file-input"}),c.a.createElement(Ye.a,{name:"name"},function(e){var t=e.input,n=e.meta;return c.a.createElement(c.a.Fragment,null,c.a.createElement("input",Object.assign({},t,{type:"text",tabIndex:2,placeholder:"username",component:"input",autoFocus:!0})),n.error&&n.touched&&c.a.createElement("span",{className:"login-error"},n.error))}),c.a.createElement(Ye.a,{name:"pass"},function(e){var t=e.input,n=e.meta;return c.a.createElement(c.a.Fragment,null,c.a.createElement("input",Object.assign({},t,{type:"password",tabIndex:3,placeholder:"password",component:"input"})),n.error&&n.touched&&c.a.createElement("span",{className:"login-error"},n.error))}),c.a.createElement(Ye.a,{name:"pass2"},function(e){var t=e.input,n=e.meta;return c.a.createElement(c.a.Fragment,null,c.a.createElement("input",Object.assign({},t,{type:"password",tabIndex:4,placeholder:"confirm pass",component:"input"})),n.error&&n.touched&&c.a.createElement("span",{className:"login-error"},n.error))}),c.a.createElement("div",{className:"controls"},c.a.createElement("button",{type:"submit",disabled:a||r,className:"btn btn-primary btn-primary--wide"},"Sign In")))}))},$e=function(e){var t=e.isAuth,n=e.component,a=Object(w.a)(e,["isAuth","component"]);return console.log(t),c.a.createElement(l.b,Object.assign({},a,{render:function(e){return t?c.a.createElement(n,Object.assign({},a,e)):c.a.createElement(l.a,{to:"/login"})}}))},et=Object(i.b)(function(e){return{activeWindow:e.activeWindow.path,isAuth:e.auth.isAuth}})(function(e){return c.a.createElement("div",{className:"App"},c.a.createElement(u.a,null,c.a.createElement(l.d,null,c.a.createElement(l.b,{path:"/login",component:ve}),c.a.createElement(l.b,{path:"/sign-up",component:Ze}),c.a.createElement($e,{isAuth:e.isAuth,exact:!0,path:"/",component:Be}))))}),tt=(n(83),n(15)),nt=n(42),at=n(43),rt=n.n(at),ct=n(44),it=Object(tt.combineReducers)({activeWindow:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:E,t=arguments.length>1?arguments[1]:void 0,n=t.type,a=t.payload;switch(n){case"SET_CURRENT_WINDOW":return j({},e,{path:a});default:return e}},auth:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:be,t=arguments.length>1?arguments[1]:void 0,n=t.type,a=t.payload;switch(n){case"AUTH_LOGIN":return he({},e,{currentUser:a});case"SET_IS_AUTH":return he({},e,{isAuth:a});case"CURRENT_USER_UPDATE":return he({},e,{currentUser:a});default:return e}},users:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:fe,t=arguments.length>1?arguments[1]:void 0,n=t.type,a=t.payload;switch(n){case pe:return me({},e,{entities:a.entities,ids:a.ids});case"ADD_NEW_CHAT":return me({},e,{entities:me({},e.entities,{},a.chat.entities),ids:[].concat(Object(K.a)(a.chat.ids),Object(K.a)(e.ids))});default:return e}},chats:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ue,t=arguments.length>1?arguments[1]:void 0,n=t.type,a=t.payload;switch(n){case"GET_ALL_CHATS":return se({},e,{entities:a.entities,ids:a.ids});case"ADD_NEW_CHAT":var r=se({},a.chat.entities[a.chat.ids[0]],{users:a.users});return se({},e,{entities:se({},e.entities,Object(g.a)({},a.chat.ids[0],r)),ids:[].concat(Object(K.a)(a.chat.ids),Object(K.a)(e.ids))});case"ADD_NEW_MSG":var c=se({},a.chat,{lastInteraction:JSON.parse(a.chat.lastInteraction)}),i=e.ids.filter(function(e){return e!==a.chat._id});return se({},e,{entities:se({},e.entities,Object(g.a)({},a.chat._id,c)),ids:[a.chat._id].concat(Object(K.a)(i))});case pe:var o=e.entities;return e.ids.forEach(function(t){var n={};e.entities[t].participants.forEach(function(e){n[e]=a.entities[e]}),o[t]=se({},o[t],{users:n})}),se({},e,{entities:o});default:return e}},activeChat:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ie,t=arguments.length>1?arguments[1]:void 0,n=t.type,a=t.payload;switch(n){case"SET_ACTIVE_CHAT_ID":return re({},e,{activeChatId:a});case"SET_CHAT_TIMELINE":return re({},e,{timeline:a});case"UPDATE_CHAT_TIMELINE":return re({},e,{timeline:[].concat(Object(K.a)(a),Object(K.a)(e.timeline))});case"ADD_NEW_MSG":return re({},e,{timeline:[].concat(Object(K.a)(e.timeline),[a.msg])});default:return e}}}),ot=Object(tt.createStore)(it,Object(ct.composeWithDevTools)(Object(tt.applyMiddleware)(nt.a,rt.a)));s.a.render(c.a.createElement(i.a,{store:ot},c.a.createElement(et,null)),document.getElementById("root"))}},[[45,1,2]]]);
//# sourceMappingURL=main.d8fb06ab.chunk.js.map